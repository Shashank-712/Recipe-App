{% extends 'base.html' %}
{% block content %}

<div class="mb-4">
    <div class="mb-4">
    <form method="get" class="field is-grouped is-grouped-multiline">
        <div class="control">
            <div class="select">
                <select name="category">
                    <option value="">All Categories</option>
                    <option value="breakfast" {% if selected_category == 'breakfast' %}selected{% endif %}>Breakfast</option>
                    <option value="lunch" {% if selected_category == 'lunch' %}selected{% endif %}>Lunch</option>
                    <option value="dinner" {% if selected_category == 'dinner' %}selected{% endif %}>Dinner</option>
                    <option value="snack" {% if selected_category == 'snack' %}selected{% endif %}>Snack</option>
                    <option value="dessert" {% if selected_category == 'dessert' %}selected{% endif %}>Dessert</option>
                </select>
            </div>
        </div>

        <div class="control">
            <input class="input" type="text" name="search" placeholder="Search by title or description" value="{{ search_query }}">
        </div>

        <div class="control">
            <button type="submit" class="button is-info">Apply</button>
        </div>
    </form>
</div>

</div>

<div class="columns is-multiline">
    {% for recipe in recipes %}
        <div class="column is-one-third">
            <div class="card mb-4">
                <div class="card-content">
                    <p class="title is-5">{{ recipe.title }}</p>
                    <p class="subtitle is-6">{{ recipe.category|capfirst }} | {{ recipe.difficulty|capfirst }}</p>
                    <p>{{ recipe.description|truncatewords:20 }}</p>
                    <p>By: {{ recipe.author.username }}</p>
                    <p><strong>Average Rating:</strong> {{ recipe.average_rating|default:"N/A" }} ⭐</p>
                </div>

                {% if request.user == recipe.author %}
                    <footer class="card-footer">
                        <a href="{% url 'recipe-edit' recipe.pk %}" class="card-footer-item">Edit</a>
                        <a href="{% url 'recipe-delete' recipe.pk %}" class="card-footer-item has-text-danger">Delete</a>
                    </footer>
                {% endif %}

                {% if request.user.is_authenticated %}
                    <div class="card-content">
                        <form method="post" action="{% url 'recipe-rate-ui' recipe.pk %}">
                           {% csrf_token %}
                            <div class="field is-grouped">
                                <div class="control">
                                    <div class="select is-small">
                                        <select name="rating">
                                            <option value="1">1 ⭐</option>
                                            <option value="2">2 ⭐⭐</option>
                                            <option value="3">3 ⭐⭐⭐</option>
                                            <option value="4">4 ⭐⭐⭐⭐</option>
                                            <option value="5">5 ⭐⭐⭐⭐⭐</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="control">
                                    <button type="submit" class="button is-warning is-small">Rate</button>
                                </div>
                            </div>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>


{% endblock %}




